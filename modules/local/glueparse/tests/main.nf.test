nextflow_process {

    name "Test Process GLUEPARSE"
    script "../main.nf"
    process "GLUEPARSE"

    tag "modules"
    tag "glueparse"

    // Real run (uses your JSON in the module tests folder)
    test("glueparse: real JSON") {
        when {
            process {
                """
                // Input signature: path '*'
                input[0] = file("${projectDir}/modules/local/glueparse/tests/Test_2.3a_D17763_major.major.nodup.json", checkIfExists: true)
                """
            }
        }
        then {
            assertAll(
                { assert process.success },
                { assert snapshot([
                    GLUE_summary: process.out.GLUE_summary,
                    versions    : process.out.versions
                ]).match() }
            )
        }
    }

    // Fast stub run
    test("glueparse: stub") {
        options "-stub-run"
        when {
            process {
                """
                input[0] = file("${projectDir}/modules/local/glueparse/tests/Test_2.3a_D17763_major.major.nodup.json", checkIfExists: true)
                """
            }
        }
        then {
            assertAll(
                { assert process.success },
                { assert snapshot([
                    GLUE_summary: process.out.GLUE_summary,
                    versions    : process.out.versions
                ]).match() }
            )
        }
    }

}
